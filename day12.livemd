<!-- livebook:{"persist_outputs":true} -->

# Advent of Code 2023 - Day 12

```elixir
Mix.install([:memoize])
```

## Sample

```elixir
sample = """
???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1
"""
```

<!-- livebook:{"output":true} -->

```
"???.### 1,1,3\n.??..??...?##. 1,1,3\n?#?#?#?#?#?#?#? 1,3,1,6\n????.#...#... 4,1,1\n????.######..#####. 1,6,5\n?###???????? 3,2,1\n"
```

## Input

```elixir
input = """
.#?#???????.????# 1,2,3,2,1
?????????? 1,1,4
????.??.??.??? 1,2
??????#??????.? 2,4,1,1,1
?.?#??.?.#####???? 2,9
???#?.??.???? 3,1,1
.???????.?# 2,3,2
?.#????#??.#? 4,3,1
..?????.??????###?? 1,6
.####?????#.?.?#? 7,1,2
#????#????.??????.#? 1,1,5,2,1,2
.??#?.#???#? 1,1,1,1
.??#???##.?????? 7,2,1
????????????.??#???. 1,1,7,1,1
?????????# 1,5,1
?#?.#????#????#???? 2,2,1,4,1
?.??#????### 3,3
????##??????##??. 1,3,9
.????????. 1,2
?#.????#.. 1,2,1
?.??#????.##??. 1,1,3,1,4
.??.??#?##?##?? 1,5,2
?#.?????.?#?? 1,1,2,1
?#??.?#?#??????#?#? 3,14
#???##??.?? 8,1
#?.#??????##?.? 1,1,7,1
??.#??#??# 1,1,5
??#???##?###??.??? 13,1,1
?##????#????? 9,1
?.??.##?.?? 1,3
?#??#?.??? 5,1,1
???#?#?.???#?#?#. 6,8
??..?#?#????? 2,5,1,1
#?#?##.??.?#??#?.?? 6,1,5,2
?.??#.#????????? 1,3,1,1,2
?.??.????#?.???#??? 1,1,1,3,7
??###?.??##?#? 5,5
????#???.???#?? 7,2
????.?????# 3,1
#?##??.?.?##??#?#?# 5,1,7,1
??##.#?.#?..?? 4,1,2,1
????.???..#?#? 4,2,3
???????#.????? 1,6,4
#??????#..?.??.?#??? 3,4,1,1,3,1
?#?##?..#?? 4,1
?##???.#???#?#??? 4,1,3,1
.?#??##?????#? 8,3
?.?.?????#??????#?? 1,8,3,1
????#?.??#????. 4,5
?#..#??????#?.? 1,1,5,1
??##??#??.?. 2,3
.??????.#??? 5,3
????????#??? 2,2,1,1
..#?#?##???????#?? 8,4
?????.??????.#?#??? 3,6,1,1,1
.??.??.#?#.#?????#.# 2,1,1,1,7,1
..??.????????#??? 1,9
??.?????#?.???? 1,3,1,3
???.?.#????? 2,1,3
.#????????? 1,5,1
????#??.???#????? 2,8
????.??.??#???? 2,1,1
..?.?????? 1,4
?#?#.#??.?#??#.??? 3,3,4,1,1
.#..???.?? 1,2
?.??#??#???# 2,2,1
##???.??????? 5,1,2
.#???##??????.??# 1,5,2,1,3
#.?.??#????? 1,1,3,1
.??##?#.?#?#??# 5,1,1,1
?????#?.??.?.?#??? 1,2,2,1,1,1
??##?????? 1,5,1
.?.???????#.?? 1,3,1
..???????#?##?#?? 3,9
??.?#????????#?..#?? 1,12,1
..??#?#??..????.? 1,5,3,1
.#?.?...?.??. 1,1,1
??#??.?#??????.?? 4,1,1,1
.#??##??#?? 1,6
??..#???.???.? 1,1
???#??..?. 6,1
??.??.#?????#.?#?? 2,4,2,2
???..?????.?#??#.?? 1,4,5
...?#??#??..??#?##? 6,4
.?#?##?.??.??##??#.. 6,7
???????#???? 2,4
#?.#?????#??..??? 1,2,4,3
?????????#? 1,6,1
?.?##??.#.? 4,1
#?????#.?.?#??#??? 1,5,1,1,2,1
???.?????.#??#.?# 1,4,1,1,1
..?..?#???..?.?#? 4,1
##.??????##??#???? 2,1,1,2,1,2
#?.#????#?#????#? 2,1,3,7
.?#?##?#????#???? 12,1
?????????#??? 1,3
????##?.#?????#. 1,2,2,2
#.?.????#???.#??#??? 1,1,3,4,5
?#??#?#.?##.?####? 7,3,4
????????#?#. 3,2,1,1
??????#?#??#?? 6,2
???.????...?? 2,4
??##???##..?? 5,2
??#.#?.?#??? 1,2,2,2
?#????#??#?????? 1,1,2,1,2
??.?#?#?#??..?????? 6,2
???????#??.??????#? 1,4,3,2,1,2
..#??#???##??? 9,1
???...????? 1,1,2
??#??..???#???.#? 1,3,1,4,1
??.#?.???#?#?.? 2,2,1,4,1
#????##??#..?? 1,5
.????.?#??? 2,1
?#?#.?.?.????## 1,1,1,1,2
???#?????.?#??#.? 4,1,4,1
?.??.?.?##?? 1,1,1,4
##??#????#.?..#?# 3,4,1,1,3
.#..??.??#?? 1,2,3
????.##.?? 1,2,1
#..?????????# 1,5,2,1
?#?#????#?????? 2,1,3,2,1
?#?.?##?#?? 2,5,1
??#????.??? 7,1
?#???#?.?.?.??. 1,4,1,1
.????##.#.??#??#??? 6,1,1,7
.???????#?##?? 2,7
?.?#?#???#?#.??.???. 1,1,1,5,2,3
????#?#?.?????.# 6,2,1
???..#??.?..#??.??. 2,1
?.?.???#?.. 1,3
?#????..???.?? 3,1,1,1
#??.?.?#?? 3,1,1
?????.????? 4,5
??????????#??#??? 4,1,1,1,4
??#?.???#??.?????#?# 2,1,4,1,1,1
###.??.?#???#?? 3,1,6,1
???##???.?##???##?? 5,8
..???##???#?.# 6,2,1
??..???????#???? 1,1,3,1,1
..????#.???. 1,1,3
???..??#??#???#??? 2,4,2
??#??#???????##? 1,1,5,2
.#??#?###..?????#.. 8,2,1,1
.?????????? 1,4
??##???????.##?.?? 5,2
?###?.????#??##??#?? 5,11,1
.?##??????? 3,1,2
.?##???.?#?#?## 4,7
?????##??? 2,4,1
????##????#??????? 10,1,1
????#???#.?..???? 1,1
#??#????.?.????? 4,1,1,2
?#?.?.??#?? 1,1,2
?????.?#?. 4,1
?.???????.????? 1,1,1,1,2
?.???..?????#??#.? 3,8
????#?.??? 3,1
???#?#??#???##??? 1,12,1
?#?..#???.?????????? 2,4,8
?#???#?????#????? 3,1,5,3
?..?.#???.?##?? 1,1,2
?.??.??#?#?#?? 1,7
.?##?#??.?# 5,1
#??#?##??#?#?. 1,4,2,1
.????####. 2,5
????#???????? 7,3
?#?.?#.????.? 1,2,1,1
????????????#??? 1,10,1
.??.???#???????..?? 1,6,1,1,2
??.??.?????? 1,3,1
?##?????#???.? 3,2,1,1
?.??#??.?.????.??.?? 1,4,1,1,1,2
??##????????#????? 1,2,2,8
???#??##..?.?? 8,1,1
??????..?#? 3,1
??.??????#?#?.?.? 1,6
?#????#???#?#?.?? 13,2
#?????#???##??? 8,2
???.??##.?.. 1,4,1
?.?????.##???###?#?? 1,10
?#?.#.?#??????. 1,1,8
?.???#???.?.#?#?#.? 6,5
#???#??#???? 1,7
??###????#?##?#.#?? 12,1,1,1
????.#.?#???.?.? 1,1,2,2,1
??????#??????..?? 1,1,8,1
.??????#??? 2,1,3
.???.????? 2,1
.?#?#???#???#?#?.# 4,1,3,1
##?.???????.??? 2,1,2,2,1
?????..???? 2,2
?##?#???????#.? 7,1,1,1
?#.#???.?.##??###??? 1,1,1,1,10
???#?#?????????##? 1,1,5,1,1,3
??.??????. 1,4
?#??##???# 5,1
?.??.#?#???????##?? 1,1,3,1,1,4
??.????#???#?#????? 6,7
?..#?#?????? 5,1
??????.??????? 3,4
???#?#?#??##??? 1,1,1,7
????#?.?#??.?? 5,3
???#.#????##???? 3,8,2
?#?#??.??#.?? 4,3
##??#???..? 5,1,1
?##?#.?##? 4,3
??..?.?#??.?????#?? 4,3
#????#?##??#?.?.???. 1,7,3,1,1
?.#?#??##??.#?#?? 8,4
?#..??#?#? 2,1,2
????##??#? 1,2,2
.????#??##??????? 5,3,2,1
###?????#?.??????? 3,2,1,2
?.#?.?#?#??#? 1,4,2
???.????##...?????? 2,3,2
?#??##??????#? 5,1,1,1
???#?????? 5,1
?.###?????#?? 3,5,1
.???.?????#?.?? 1,6
.???????.. 1,1
??????#????#?# 7,1,1,1
??.???#?????#???. 1,13
.???#????? 1,4,1
????#??##.?# 1,1,2,2
.?#???#???##??..#.# 7,4,1,1
..????.?????#? 3,3
??#?#..??? 5,3
??????????.? 1,6
?.?#.??..?##??????#? 2,1,8,1
??...#??????##? 1,2,1,3
.????.??#.???#?? 1,1,3,1,2
?#???????? 1,3
.?#.??#.???#?.? 2,1,3,1
?#????..????.# 1,2,2,1
??.?##???#...#?? 6,2
??#???#????.? 3,2,2
?????#???#????? 2,6
.#?.?.#.???? 1,1,1,3
?###?#??#??#.??? 3,1,1,1,2
.??##??????#??#??.#? 6,1,1,2,1
...?????#?##????? 1,1,8
.#??.###???#? 2,3,3
?.#?.??????#??##? 1,8
??#?##????????#? 6,1,2
??.??#?.######?.?.? 3,7,1
?#??#????.?????####? 6,1,2,6
????????#.???#?? 4,2
.##??#?#???????.?#? 3,1,3,1,1,3
.??.?????? 2,1,2
??.???.????. 1,1,1,1
#?.?#??#???. 1,4
??#??#????##?? 5,4
#??????????? 1,2,2
???.?#??.??#?? 3,3,3
?????.???? 1,1,2
?...??.#.????##??? 1,1,1,7
.????????.? 2,2,1
?.?#.#?#?????#???? 2,1,3,5
????.#?.????? 2,1,3
??.#???.??????##?##? 1,2,1,1,7
??#?????.??#?#.. 5,4
.##?#?#??#????.? 6,5
??..??????#???#.#?? 2,1,1,7,1,1
#???.??.?? 3,1
.??#??#??? 4,3
#????.#??.????? 2,2,1,1,3
.?#.???.??.??.?. 1,3,1,1,1
?????#????#? 1,1,1,1
.??#???.#.? 5,1
?.??#????#?#??#??#?# 1,4,4,2,1,1
?.????.???#? 3,4
??#?.????#???###?#?? 2,2,1,8
##???.?#?#??? 2,2,1,3
?.???.?#??? 1,3,1
??????????? 3,2
#.??#????## 1,8
??#?#?.??.?? 1,4,1,1
??#????#?.#??? 7,4
?????#????#??#???.? 6,6
???..#.????#????#.? 1,1,1,2,7,1
#?###???????????.?. 5,4,1,2,1
..???##?.???#??#??? 3,7
.#???#.?#.?.? 2,2,2,1
##?????????????###?? 4,2,1,2,5
??.?#??#???? 1,2,1,1
?.#.??????.?#?##?#? 1,1,2,2,7
???..????. 1,3
#????#?.??#?#. 2,3,2,1
?.?##.???.? 3,1
??#?#####?##?##.???. 9,5,1,1
.????????## 3,2
??#????#.????#????? 3,2,5,1,1
??.??##??? 2,2,1
.??#??.??#??#? 4,5
???????#.?#. 1,1,1,2
?#.??#?????#??#.?#.? 1,12,2
?.#???#.?.?. 1,1,1,1
.????????#?#??#?? 2,8,1
??..?#?.###? 1,4
??##????#??.???#? 4,3,1,1,2
?????.????? 2,3,1
???#????#????#??? 1,10
??????##?#???.?????? 6,4
..??..#?????#?#??? 2,7,1,1
#?#?????.#?? 1,1,1,1
?.???#???#??#?? 1,1,10
?????#?.#...? 5,1,1
?????.??.????????## 2,1,1,10
.???.?????. 1,1
???#?????.?????###. 1,2,2,2,4
?.??????.??#???? 1,2,1,2,2
????.????. 2,2
?.????.?#??????? 1,3,2,4
.?????#?.??#???? 1,4,1,4
???.?.??..? 3,2
?.??#?????? 4,1
##????#????#. 9,1
??.????????? 2,3,1
?#????#.??.?????? 4,1,2,3,1
????..??#?#? 1,5
#???###???.????. 1,5,3
??.???#.????#??#.# 1,4,2,5,1
.??##?????.?##??. 4,3,3
??.#.##?.?????? 1,1,2,1,1
?#.?????????? 1,1,1,3
?#..??#???#??#?.?#?? 2,4,3,2,2
?.?..???.#??. 1,2,2
?.#?#?...?????? 3,5
.#?.???????. 2,1
??????.????#?## 1,2,7
???.????#?????? 3,4,1,1
.????#?#??.#? 3,4,1
?.?#??#??#??#.????# 10,1,1
??.??.??????#? 1,1,4,2
.#?????#??? 1,5,2
?.????????? 1,1
?#?#??????? 6,1
.#?##?.????????## 5,1,5
????##?#???????? 5,4
..?#.#??#?#???#??#?# 2,4,1,1,4,1
.?##?.?#.??? 3,2,2
?.??#??##.?##??? 7,3
?.#????.???? 4,1,1
#???.??.????##? 2,1,2,1,3
.##?..????????#?? 2,4,1,2
????#?#.????? 5,2,1
???#?.?????#?????#. 3,11
?????###.#???. 8,1,2
??.???..?#??#.?.??? 1,1,1,4,1,3
..???.??.? 1,1,1
?###???.#???#???# 6,1,2,2
#?.????..???????? 1,1,1,1,5
??#???#?.?#??.?#? 7,3,1
??##?.????#??.????. 5,5,1,1
?????#??##?#?? 3,8
.???###??????.??# 8,1
??##??.???# 4,1
?.??#?#??#?. 2,5
#???.#??????. 4,1,1,1
???#.???#.#??#? 2,3,1,3
?????##???#.??..# 1,6,1,1,1
.#?.?#?#????##???? 2,13
??#????.#??#??#??? 1,1,1,1,7
.#.?.#?.???. 1,2,2
?#???#?#?.???#??#??? 8,7
??????.??? 2,1,3
#??????.???#? 3,3,1,2
???.#????? 1,1,1
???..?##?#?#??.?.# 1,9,1,1
..????#??#?????? 3,5,1
.???.??#?????.. 1,6
?#???#???????# 5,4
..?#????#?. 2,3
????#..#??# 4,1,1
.???##?#????#?#? 1,5,6
???##??#???#?#..? 7,4
???#??????#??.?? 6,1,2,1,1
.???????..??.. 1,5,1
?????.????# 4,2,1
.???#??#??#??.? 5,2,1
??.#?????. 1,1,2
.?.????.??#.???# 1,1,1,1,4
??##???.?.????? 4,1,1,1
.?#?.?????????? 3,2,1,1
???#???.??##??# 4,1,7
?????????###????. 7,6
????..#?????#???? 1,1,4,3
??#?#?##?????# 3,2,3,1
???.??????.##.? 2,1,1,2,1
.???#????? 3,1
?????.???#???#? 5,2,3
##????????#???#??##? 2,1,2,4,1,3
.?.#??????.?. 1,2,1,1
.?.?#?.??.?# 1,1,1,2
??#?.???.?? 2,2,1
??????##.????#???? 1,6,5,2
.?????.???#??#?#.. 3,9
?##???#..#?.??? 6,2
??..??.????#?# 1,1,3,3
#??#???.?#?? 1,3,1,2
.#?#.#???? 3,1,2
?????..???## 2,1,2
???#??#???.#???#.? 5,1,1,2,1
?##????.#?#?#??#?.?? 5,1,9,1
?.?????#?.?##???#?## 4,1,9
.#???#...??.?. 5,1
.#??#??#?.#??..#??? 1,6,2,3
??##..?.##?#??.? 3,1,2,2,1
?????##????#????.? 9,4
#?.??????.?. 2,1,3,1
#???????????????#?. 3,12
???.?..??#?#?????? 2,7,2
?#####????#???#??#?? 11,5
??.?.#????? 1,5
????#..?#???? 1,1,3
#????#?.??#..?#.? 6,3,2
??###???##???..??? 9,1,2
??..?#?#???????.? 1,7,1,1,1
?#?.##?##??.#??. 2,5,2
????????#...? 6,1
#?????#??##?.?..#??? 7,3,1,1,1
?#?.????????? 1,7
#???????#.??? 5,3,1
?#?#???#.??? 7,2
??#??.?#????.?? 1,1,1,3,1
?.#???.??? 1,1,1
?????.???##?? 1,5
.??##???.? 6,1
??.###?##? 1,6
??.??????#?##. 1,1,1,4
????.???.?#??##?. 1,6
?????#??#?#?.#?????? 3,4,2,2
?????.?.?#? 3,1
#???#????.?#? 1,2,1,2
##??.????#??##??? 2,9
??#???????????.?.??? 1,1,9,1,2
???#?##?.?##? 8,3
?.?#?##????????.#.?? 7,2,1,1,1
?#??????#??#?#?? 2,11
????.?#?#?#????????. 3,6,5
????.??#.???..??.. 1,2,1,3,2
?#.??.?.??.??? 1,1,1,3
???#??##???.#?#?? 3,3,2,5
.#??###???? 1,3,1
.?.????..? 1,1,1
.?#???#..? 1,1
###?#?.#?#.???.?? 5,3,1,1
?.???.####?#?#? 1,4,3
.#?#?.#???.???? 1,1,2,1,1
.????????.???? 2,1,2
??##????#??????#???? 4,12
?#?????#?????.??? 2,3,6,2
.????????#??? 1,4
?????????###??###?? 3,8
???????#?.? 5,2,1
###.??.?##??###. 3,1,7
?????#?#??#???#.? 1,12,1
.????#????#??#.?? 13,1
..???????#??.??.?? 4,1
?????#?#?#???#??? 1,9,1,1
??##.????.? 4,1,1
????.??..##????#. 3,1,7
.??.?#.???. 1,1,1
??#??#?#?.???# 5,1,1,2
?####??#???.????#.? 5,3,4
?#???#????## 7,2
.#??#??#??.##? 4,2,3
?.#???#???.?????? 1,2,6
?..?????#?##???????? 10,3
?#?.?????###??#????? 3,1,7,2
??????##??#?#???#.. 2,3,8
#?#?????#?. 4,1,1
????#?#?.#.??????? 2,3,1,4
?????????#??????.? 1,9
?????#??????? 2,3,1
#?#??..?##???. 3,5
???#???...??#??#?? 1,1,1,3,1,1
#?.???.???? 1,1,4
##?#??#?###?.??. 4,6,2
#??????????#?#??. 1,14
.?#???##???.??.???? 3,3,1,1,1,2
#?.????#???#?.????? 1,1,4,1,1,1
#??#?..??#??#. 2,2,6
??.????????#??.??? 1,1,1,1,3,1
.?..?????###?. 1,2,4
??#?#?#?#???#? 8,1
.#?#??.?#??#?????? 4,8
?.??###??.?. 5,1
???##????.#? 1,4,1,1
??.???.??????.? 3,4
?.????.??#? 3,3
??#??##?.#?.? 1,3,2,1
??#?????????#?? 4,4,1
?#??????.##????. 2,1,1,2,1
?###??#??#?????#??# 6,10
???.#???????? 2,8
????????#???#????. 1,1,3,2,2
.?????..??#?#?. 1,1,5
?.????#???.? 1,1,5,1
##??#???.#?. 3,3,1
????.???.?????#?##? 2,1,1,1,4
?#?##.????...?? 5,1,1,2
#?.?.??.#????#??#??? 1,1,10,1
????????##??????#?? 4,6,4
?????#??.#.. 1,4,1
?????#??#?.. 3,4
??#?????????#??# 1,11
?????.??#??.????? 1,4,3
?.?#.?????###?#.??. 1,2,1,6,1
.???.???#??.???##?# 2,4,5
?.???#.???#?###??# 1,1,1,1,5,1
??#.#?????????? 1,1,2,5,1
.??.????##????.??? 2,2,7,1
??..??#???????.??..? 1,7,1,1
???.?.???..? 1,1,3,1
????..??.?#???.??. 2,1,1,2,1,1
?###???#???????## 4,2,3,2
.?##??.#??? 5,1
?#??##?#?#??#?#???. 9,4
.##?#?.##?????. 4,2,1
??#???????? 3,3
??#??#???#?..??#? 5,3,1,1
.??#??#?????.?.#??? 10,1,1
??#???.???? 5,1
#????#???.?? 4,3,1
.?##?????#? 6,2
.##?#?##???????. 7,5
?#??.??#????#??#??? 1,5,2,4
???#???.#??#..?#??? 7,2,1,4
?????.???.?.??.??. 1,2,1
???.#.?.????? 1,1
????????#?#?# 2,2,1,3
?#???????#.???## 1,4,1,3
?.????.????????? 1,1,1,5,2
???.?????#. 3,1
???.?#????.?# 1,2,1,1
??#?.#??.? 1,3
.?.??????#.????? 1,4,1,1,2
#????.#?#???? 1,2,6
..#?##??#??.#??#? 1,6,2,1
.???????#?#???##??# 12,3,1
.??#?.??#???????.# 1,1,1,1,3,1
?..?????##??.?#????? 8,5
.#?..?.??. 1,1
...#??#?.? 1,1,1
???#..?.????.#?## 1,1,1,2,4
#?.???#??#???.#?#??? 2,2,1,2,2,4
.##?#.??.??????? 4,1,1,1,1
.?#?#????? 1,1,2
???#???.??#.??? 4,3,2
?#..#???###?#?#?#? 1,13
#??#??#??????#???? 1,7,1,1,1,1
#?.#??#????.??.?###? 1,2,2,1,1,4
?#?#?.??????.????. 3,4,1
.???.#?.??#.?.???# 2,1,1,1,1,3
.????.?????#?#?. 2,8
?#????###??? 1,4
??#?##?????????.? 9,2,1,1
???#??????????#.? 6,1,1,1
.??#???#????##??#? 5,6
??##???.??.#? 2,1
?#?#?##???????????#? 10,1,5
?.#?????.?.#????#?? 1,2,7
?##?.???????? 2,3,1
???.###????.#? 2,4,2
??????.??? 1,1,2
#???.????????.#? 1,1,2,2,1
#.???????#? 1,3
.?.##??.?#?.. 3,2
#.?#.????##?#????.# 1,1,3,5,1
?#?????#?#????? 5,1,1,1,2
??.#??.?.???.?.#.??# 1,3,2,1,1,3
.?.?#???#?? 1,4
??.#??#?.?#???? 1,4,1,1
?.?#????.?.#?# 2,2,3
?##?.??#?#?.?#. 3,1,2,1
?.??.???.???#???.? 1,2,3,3,1
??##?#???####?#??? 4,1,5,1,2
#.#??????????????#?? 1,1,3,1,1,6
#?.?.?.#.#?.?????? 1,1,1,1,1,4
???#?#.??? 1,3,2
#?#??#??.##? 1,2,1,3
??#??#????? 6,1
???.?#???.? 1,1,2
?.#..???#??##??? 1,4,4
?..#??.#?... 1,1
??...????#????.? 1,3,1,3
???????#?#??????# 1,1,2,5,1
?#???????##?.??? 3,6,2
?#????#???? 2,2,1
??????#???# 1,5
?.????#??.?.??.. 6,1
.??.??#????#? 1,1,1,5
?##.???.?.?# 2,1,2
????#??????? 1,2,1,2
.#.???#????? 1,7
???????#?#.? 2,2,3,1
?.???#????????#? 1,3,4
????????..? 3,2,1
?.????#?.????????? 1,1,3,6,1
??.#.?#????. 1,1,3,1
.??#???????#?..? 5,1
#?.??##?.????# 1,5,1
???.?????#??. 3,6
?.????..???????##? 2,9
.?##..??????? 2,1,4
?#?????????????#.? 6,4,1,1
??#?##?#?? 5,1,1
??#????#??????#?? 3,3,1,3
????.?#..?#????? 1,1,3,2
??#???...#?.?.??. 6,1,1,1
?.????#?.#?. 1,1,2,1
???#?#?????#?????.?? 6,1,1,1,1,1
?????#?#???#??#?#?.. 7,8
#..#.??.#??#?##??.. 1,1,1,1,6
????.?#?#?? 3,6
?#.?.#?????? 2,1,2,1
??#?#??????????# 11,1
?.#??####?????????#? 1,1,4,2,1,2
?.?.?#?.??#?? 1,2,3
????#???#????#?.???? 1,3,1,5,2
???#?.???? 3,3
?##??##.???.#?.##. 3,2,1,2,2
?###??#?.?#.#??? 4,3,1,2,1
.?????????##????? 2,8,2
?.?#?..??#?????? 3,5,1
#.??#???#????#.??? 1,12,1
..?#????##? 2,2
???????#???##???. 2,5,5
???#??#??.#???.#.# 3,3,2,1,1,1
.???#.#?????#??.?## 1,1,1,1,3,2
#????????#. 3,1,1
???#.#??#? 2,4
????.##???#???.??? 1,1,9,1,1
?.???#?#?.?#???? 6,4
????????#?...#? 2,1
????#????##???? 1,8,1
?.???????#.. 2,4
?..?#??#?##? 1,7
?#???.#??.???##?? 2,2,4
?##.????##??? 2,5
??.?#..?.#?#??? 1,2,1,6
???#??.?#??????# 4,9
.?????.????### 5,6
.##..#??#????... 2,8
??#??.?????#?#? 1,1,1,3,4
##??#.??#?? 2,1,2
??##?###.##?#? 1,6,4
.???????#?# 2,1,3
??.???#?#.??##? 1,2,1,1,5
?#???#?#.?#?#??#.? 2,4,2,4
??????.??? 1,1
??????????? 1,1,4
???#?#?????##?? 7,4
?##??????. 3,1,2
?.#?.???.?.###?? 1,2,3
???..??..#.##??. 3,2,1,2
?.??.?????#?????# 1,1,1,7
??.#.#..#?#? 1,1,1,4
##?##???.?????##??.? 2,2,1,8,1
.?.???.??.?????.?.?? 2,4
??.???????.. 1,2
?????#????????.#.??? 1,4,3,1,3
?????.??#????. 1,2,6
?##???##.??.? 8,1,1
.##??????? 3,1
?#?#??????????#?##?. 3,7,1,2
#????#??.###?##.?? 1,4,1,6,1
??#.??#??.? 1,5
.?#?#???#???## 1,2,7
??????#?###??.? 2,9,1
???.??##?##.?? 1,4,2
?????..????? 1,1,1,1
??.?.????#??#?.? 1,1,6,1,1
...?.#??#?#?#?? 2,5
.????#???????.#. 6,1,3,1
?.???#????. 1,7
.?#???#????#?##?? 5,7
????..?#??#??#???.? 1,9
???##?#.???.?.? 6,1
#??#??.??##?#???? 1,2,9
?.????#??????? 2,9
???????.?#. 1,2,1
#?..??#???.??#?# 2,3,5
????..??.??.? 1,1
??????##.???? 3,2,1
???.?????#?.##? 2,4,3
#.??#???#.?#?????#?? 1,4,1,1,1,2
??.?#????.??#? 2,6,1,1
#?#.?????.??####??? 1,1,1,2,6,2
??.???##?#???## 7,3
.???.??#?? 1,3
.??##.?????? 3,1
##????#???#?#??#?? 13,2
.??#??#?..# 7,1
.?????#?.?#????#?? 7,1,3
??#??.??????# 4,3,2
??#?#...??###..??.?. 3,3,1,1
?#.??#??.?#?..?? 2,3,2,1
.??#?#?#?## 1,5,2
?.#???.??#???#??#? 4,4,5
?.??#??.#?.?#??#?. 1,2,1,2,1,3
??#??.???????#?#?.?? 3,7
?.??#?#?.????# 5,1,1
??#?..?##.#?? 1,2,3,3
.???.#???? 3,1,2
???#?.???????? 2,6
?.??###???.#.????. 5,1,1,4
.??#??.?????? 4,2,1,1
??.????#.?. 1,2
#???.?.????????# 1,2,1,2,1
???#???????#??#?.?? 2,2,4,1,1
#??#???#?#??#.???. 5,1,4,2
?##??????# 7,1
?#?????.?.. 6,1
????.?#.???###??. 1,1,7
????#.#??. 2,1,3
??.#????.??. 1,4,2
.????#??.???#?.. 6,4
?.????#??#?##?.?..?? 11,1
?????#.?.????????.# 1,2,2,4,1
?????###?#????? 1,1,3,1,1
?#??##?#??##. 2,8
??..?????#??##. 1,1,1,2,3
.????#.???#??### 1,1,1,1,3
??..##?????##.??.? 1,5,3,1,1
??#?#?????# 6,1
?????#??????????? 8,4
?.???????# 4,1
??????.???? 5,1
????????#?.??????. 6,3
.???#???.???# 5,2
.??????..????#??## 2,9
#???#???.?? 5,1
???????#..??##?? 1,2,6
???#????##???????? 2,9
?#?.????#??#???#??. 2,1,11
#??????#???####??.? 8,6
????#?#???? 3,3
??###.?.?????? 5,1,1
????#???#?#?#?##?.. 1,2,9
?####?.?.# 5,1,1
??##?#??#? 2,1,2
?.??##?.?.?##?##??? 5,3,3
#??#.##?####?#??? 4,9
?#??.#????#.?.?? 3,2,3,1,1
?????##????#?#??##?# 9,4,2,1
.????#??????? 3,2,3
???????#?#??##?#? 2,1,7,1
????????#?#???? 2,1,4
.?#.#?##??##. 2,5,2
??#?#?????#.?#?.?# 9,3,1
??.?#???##?????.?? 11,1
?.#??????##???#?? 1,1,1,3,3
?#???.??????????#?. 3,1,3,1,4
?#.?????.#?. 2,1,1
????.????? 3,1,2
#?.#?????#???? 2,7,1
??#.?#?#?##??.#?.? 1,1,2,5,1
??????#????.. 2,3
.??#??.?.?..??.? 3,1
?#?#.#?.???? 2,1,1,3
#.?..????#????? 1,1,1,4,1
??#???????? 4,4
??????.????????#?? 4,1,1,3
?#?....????. 2,2
??#??#...??# 4,2
??????.?????#? 4,1,1,3
.##?#???#?????.#? 2,7,1,2
??#?????#.??#? 4,3,3
???#???????? 9,1
?.?.#????#??#??.??## 1,10,3
.?###?#..#.?. 6,1,1
?#??..????#?#? 1,1,6
..#.?????##?#? 1,1,6
???.?.#????##?#?. 1,1,1,1,4
?????????.?#??? 1,1,2
????#??#??##? 1,2,1,2
??#??.?###??????.? 3,8
?#????????. 3,1,1
???#?#???#??.?#.. 4,4,1
?.#??.????#???????? 1,1,7,1,1,1
???.??#?##????#? 1,8,1
???.?.???????#????? 1,1,1,1,6,1
..??#?.???#??? 4,4,1
????????#?.???.???? 1,2,3,3,4
?????????#??##???. 3,9
#????..???????.???. 5,4,1,1
??#?##???????. 6,5
????.?#?.??...#??? 1,1,3,1,1,2
?.??.##??.#?????.? 1,2,4,1,2,1
?#?????????#???.???? 2,1,9,1,1
??.?.?????.?# 1,1,4,1
.??##?.#?? 4,3
.??#??##.#???????? 1,1,3,4,3
#???????#?#?.??.?? 1,3,1,1,1,1
????##?#???????????# 1,9,3,1
??#??..????????#?.?? 2,9,1
??##?#??#.??.#? 5,2,2,1
?###?????????.??.??? 4,4,1,1,1
????.????????? 2,2
????????##?..?. 2,1,3,1
?.?.#?#???#??..????? 1,9,3
??????#??.?#?#?.?? 1,1,4,1,1,1
..????#?????????#?? 1,5,1,7
?????????#?#??#..??? 4,8,1
#??#???#.???.?..? 8,1
?#??#?????.#??? 1,6,1
???##??#???##???#.. 9,2,2
?#????#..#??????#.. 1,4,2,4
?????#.?.#?#? 3,3
????.#.????.?? 3,1,1,1
???#?..#????#??# 2,9
???.###????#???????? 4,1,3
??.??.?##?#?#???? 2,2,2,6
???.???#?#???#??#?? 1,1,1,2,5,3
.????##?##?##???#?? 1,13
??????#????#.#?#? 9,1,4
?????#??.#.??????#?? 7,1,8
??#??????.??. 1,5,1
??##?##????#??. 1,2,5,1,1
??###??????.? 4,2,1
#??????????..??#?.? 11,4
??.??#?.???#?##?? 1,1,1,4
.???.?#??????? 1,3,2
.#?#??#.????### 6,2,3
..??#???##.??#? 1,2,3,3
??#?#?.#?#.?..?### 6,1,1,1,3
??#????#??????.#. 1,1,4,2,1
?????.??##?#??#?##?? 2,1,12
??.?.?#???? 1,4
??#???#?.???? 2,3,1,1
.??.#.???..?????#??? 1,1,3,1,6
???.?##?#? 2,3,1
???????#????? 1,3,1
??.????#.#. 1,5,1
??..??#??? 1,3,1
.#??##????#???#?.? 1,12
#.#?#?????#??##??? 1,4,1,8
??????#?#....? 8,1
?.?.#????#?????? 1,3,3,1,1
????#???.##?#.??.## 7,4,1,2
#.?.???#?.?# 1,1,1,2
?.#???#?#????#??? 3,1,8
.????.##???.#???? 1,2,4,2,1
.#??#..???#. 2,1,2
???...???#?#????. 2,6
??##?.??#.??? 1,3,2,1
?#?##????????#?.? 7,4
????#.??????. 4,3,1
?#??????#. 5,1
???.???#??#? 1,7
?#????..?#??#? 5,4
#????????????.?? 1,1,7,2
?????#.???#? 1,3,1,1
.???????????#??? 3,1,1,6
??#????#????? 2,2,2
.#???#??#??????? 2,7,4
??????????##???.???? 1,1,9,3
????..??.?#? 1,1,2,2
#?????#?#??#???????? 3,14
??#???.?#.? 1,1,2
?????????????#?# 2,1,3,3
???#.?????##????. 2,6,1,1
?????.##???.? 3,4
?.#????#?????. 2,7
.###?????.. 3,2
.??#??????.#?#. 4,1,1,1,1
.###?#?##?##????. 11,2
??????.??????##????? 1,1,1,9,1
???#?.?.?.?? 4,1,1,1
??#?##?.??#?????.#? 7,2,3,2
???.###??.#??#? 1,1,5,1,2
?.?#.?#?.?#????? 1,2,1,2,1
#??????.##????? 6,3,1
?#?#.????. 4,2
?.????..?# 2,1
?.?.?.##??#????##??? 1,1,14
????#?.#???##?#????? 3,1,9,1,1
??##????.#?#.#???? 1,5,1,1,5
??#??????..?? 3,1,2,1
#?.??#?###??#.?. 2,2,4,1,1
?.#.??#?????? 1,3,1
??.???##???.#??? 1,5,1,2,1
#??##?#?#?.????? 5,1,1,1,1
???.???###?? 2,6
?#????#?.?#???#???? 2,3,1,5
??#?####?????##???. 6,4
##.??#???.??????? 2,3,1,4
??????.#????#? 1,3,2,4
#?.?????.???????#?# 2,1,1,10
.??.?????#???.? 7,1
?###.?#.?.?# 3,1,1,1
#????????.??#????#?# 1,5,2,1,1,1
??##?#?#??#?#???# 8,7
???.?.???????#.??#? 2,1,1,6,1,2
??.?????.?#?? 1,1,1,4
.????#????##?##??. 3,8
?.?????????? 2,4
?????????#?#? 4,2,3
#..??#????#??#.? 1,1,2,2,1
?#.???????.??.? 1,1,5,2,1
??#?.???????#.??##?? 2,1,2,2,3,1
???.???.#??.??? 1,1,1,3,3
#?#.???#..??? 3,1,1,2
.#?##.?????#???.? 4,1,3,1
#?.???????????##?? 1,1,2,8
?#??.????? 2,2,1
?#?##???#?##??..#? 1,2,1,2,1,1
.????????#?. 2,4
.#?.?##???????.?? 1,6,2
#.??..##???#???.? 1,1,6,1,1
?????.###?.??##??#? 1,1,4,1,3,2
.???#?.??????.?#? 4,6,2
????#?#????? 7,3
???...#??. 3,3
.#.?#??????#????#??# 1,7,1,5,1
.???#???.?? 2,2
.????.?#.?#??? 3,1,4
??.#???#???????. 1,1,7
??#?..??????# 2,1,1,1
??##????..???.?# 7,3,2
?#????#???#??..?##? 1,3,2,3
?#.#??????##??###??? 2,4,1,9
.??#.??###?? 1,1,7
??????????? 1,3
.?????#???. 1,4
??????.??#?#???#?? 1,1,9,1
#?.##?#.???#??? 1,4,1,2,1
?###??##????##???? 7,8
#???..?????.?. 1,1,3,1
#??????#.?#? 1,2,1,2
?.?#??#????.??? 1,4,2
#.#????##.###?? 1,1,2,3
?.?..????.#?..? 1,1,1,2,1
?????.#???#???? 3,8
??##?##?????#??#.? 4,2,4,2
?????????# 1,1,5
??.??#???#?????. 1,5,3,1
?.#??.#?#????#??? 2,5,3
.????.?..# 2,1,1
?.?.??????#?#? 1,1,7
?##????##????###??.? 16,1
.??????#???#..?..??. 10,1,1
?.#?#??.#???? 5,5
?????.??#??#??????? 1,1,1,4,1,1
???????.?..???..?? 5,1
??????##????????? 2,8,1,1
??????##???.????# 2,8,2,1
##.?#?.#?? 2,2,1
#?.?#.???????#??? 2,1,7
?.????..??#???????? 4,6,1,1
???#?##???? 2,6
???????....#??#???. 4,4
.?????.??? 5,2
?.##??????? 2,4
?##??##?????#????? 8,3,1,1
.?.#??#?.? 1,3
?#?????##?.?#??????? 3,3,1,1,3
??.???##?????? 1,11
???????#?.?#???? 9,2,1
??.?#????#?#????? 1,7,1,1,1
?.?????????#??#?#?? 1,1,11,1
??.?##????? 1,3,1
?#?#?????.##??###?? 2,2,2,8
????#???#???#??. 2,11
?.????#????## 5,3
????#??#?#??.????? 1,1,6,1,1,1
.??#?#??.???.? 5,2
#??#?.?#?? 2,1,4
?.??#???#.?? 1,5,1
??##???#?.???##???? 7,6
#?.?????###??? 2,1,8
??#?#?#???.#??? 1,7,2
#.?#??#.?? 1,4
????????#????.#? 1,5,1,1
?#?.???.??? 3,2
?????#?.??#?##..#?. 2,1,1,6,1
??#?..###???# 2,3,3
?.?#.?.?#????# 1,2,7
?.##?##??#??.#????## 6,3,1,4
.#??###??????#. 8,3
????#??#..? 4,2
.???.????.???#?? 3,1,5
.?#????#?#?#?#????# 1,13
?.?#.#..?.???#??# 1,1,1,7
???..?#??.??##? 1,2,1,5
?.?#?#?#.###??? 1,1,1,1,6
???.???#???#?.#?.?. 1,6,2,1,1
.?.?##..???????? 1,2,6
.#.?#???#?.?????? 1,3,1,2,2
#?????#???##??# 3,7,2
#.?#??#??.??.?? 1,1,4,1,1
??#??#???##.??##? 4,2,3
.?#?.#??#??.???? 1,6,2
##.???.???##?? 2,1,5
.?.#???##?#??? 1,9,1
????#?##.????# 4,2,1,2
???????##?#?????.? 4,8,1,1
????##?#?#??. 1,8
"""
```

<!-- livebook:{"output":true} -->

```
".#?#???????.????# 1,2,3,2,1\n?????????? 1,1,4\n????.??.??.??? 1,2\n??????#??????.? 2,4,1,1,1\n?.?#??.?.#####???? 2,9\n???#?.??.???? 3,1,1\n.???????.?# 2,3,2\n?.#????#??.#? 4,3,1\n..?????.??????###?? 1,6\n.####?????#.?.?#? 7,1,2\n#????#????.??????.#? 1,1,5,2,1,2\n.??#?.#???#? 1,1,1,1\n.??#???##.?????? 7,2,1\n????????????.??#???. 1,1,7,1,1\n?????????# 1,5,1\n?#?.#????#????#???? 2,2,1,4,1\n?.??#????### 3,3\n????##??????##??. 1,3,9\n.????????. 1,2\n?#.????#.. 1,2,1\n?.??#????.##??. 1,1,3,1,4\n.??.??#?##?##?? 1,5,2\n?#.?????.?#?? 1,1,2,1\n?#??.?#?#??????#?#? 3,14\n#???##??.?? 8,1\n#?.#??????##?.? 1,1,7,1\n??.#??#??# 1,1,5\n??#???##?###??.??? 13,1,1\n?##????#????? 9,1\n?.??.##?.?? 1,3\n?#??#?.??? 5,1,1\n???#?#?.???#?#?#. 6,8\n??..?#?#????? 2,5,1,1\n#?#?##.??.?#??#?.?? 6,1,5,2\n?.??#.#????????? 1,3,1,1,2\n?.??.????#?.???#??? 1,1,1,3,7\n??###?.??##?#? 5,5\n????#???.???#?? 7,2\n????.?????# 3,1\n#?##??.?.?##??#?#?# 5,1,7,1\n??##.#?.#?..?? 4,1,2,1\n????.???..#?#? 4,2,3\n???????#.????? 1,6,4\n#??????#..?.??.?#??? 3,4,1,1,3,1\n?#?##?..#?? 4,1\n?##???.#???#?#??? 4,1,3,1\n.?#??##?????#? 8,3\n?.?.?????#??????#?? 1,8,3,1\n????#?.??#????. 4,5\n?#..#??????#?.? 1,1,5,1\n??##??#??.?. 2,3\n.??????.#??? 5,3\n????????#??? 2,2,1,1\n..#?#?##???????#?? 8,4\n?????.??????.#?#??? 3,6,1,1,1\n.??.??.#?#.#?????#.# 2,1,1,1,7,1\n..??.????????#??? 1,9\n??.?????#?.???? 1,3,1,3\n???.?.#????? 2,1,3\n.#????????? 1,5,1\n????#??.???#????? 2,8\n????.??.??#???? 2,1,1\n..?.?????? 1,4\n?#?#.#??.?#??#.??? 3,3,4,1,1\n.#..???.?? 1,2\n?.??#??#???# 2,2,1\n##???.??????? 5,1,2\n.#???##??????.??# 1,5,2,1,3\n#.?.??#????? 1,1,3,1\n.??##?#.?#?#??# 5,1,1,1\n?????#?.??.?.?#??? 1,2,2,1,1,1\n??##?????? 1,5,1\n.?.???????#.?? 1,3,1\n..???????#?##?#?? 3,9\n??.?#????????#?..#?? 1,12,1\n..??#?#??..????.? 1,5,3,1\n.#?.?...?.??. 1,1,1\n??#??.?#??????.?? 4,1,1,1\n.#??##??#?? 1,6\n??..#???.???.? 1,1\n???#??..?. 6,1\n??.??.#?????#.?#?? 2,4,2,2\n???..?????.?#??#.?? 1,4,5\n...?#??#??..??#?##? 6,4\n.?#?##?.??.??##??#.. 6,7\n???????#???? 2,4\n#?.#?????#??..??? 1,2,4,3\n?????????#? 1,6,1\n?.?##??.#.? 4,1\n#?????#.?.?#??#??? 1,5,1,1,2,1\n???.?????.#??#.?# 1,4,1,1,1\n..?..?#???..?.?#? 4,1\n##.??????##??#???? 2,1,1,2,1,2\n#?.#????#?#????#? 2,1,3,7\n.?#?##?#????#???? 12,1\n?????????#??? 1,3\n????##?.#?????#. 1,2,2,2\n#.?.????#???.#??#??? 1,1,3,4,5\n?#??#?#.?##.?####? 7,3,4\n????????#?#. 3,2,1,1\n??????#?#??#?? 6,2\n???.????...?? 2,4\n??##???##..?? 5,2\n??#.#?.?#??? 1,2,2,2\n?#????#??#?????? 1,1,2,1,2\n??.?#?#?#??..?????? 6,2\n???????#??.??????#? 1,4,3,2,1,2\n..#??#???##??? 9,1\n???...????? 1,1,2\n??#??..???#???.#? 1,3,1,4,1\n??.#?.???#?#?.? 2,2,1,4,1\n#????##??#..?? 1,5\n.????.?#??? 2,1\n?#?#.?.?.????## 1,1,1,1,2\n???#?????.?#??#.? 4,1,4,1\n?.??.?.?##?? 1,1,1,4\n##??#????#.?..#?# 3,4,1,1,3\n.#..??.??#?? 1,2,3\n????.##.?? 1,2,1\n#..?????????# 1,5,2,1\n?#?#????#?????? 2,1,3,2,1\n?#?.?##?#?? 2,5,1\n??#????.??? 7,1\n?#???#?.?.?.??. 1,4,1,1\n.????##.#.??#??#??? 6,1,1,7\n.???????#?##?? 2,7\n?.?#?#???#?#.??.???. 1,1,1,5,2,3\n????#?#?.?????.# 6,2,1\n???..#??.?..#??.??. 2,1\n?.?.???#?.. 1,3\n?#????..???.?? 3,1,1,1\n#??.?.?#?? 3,1,1\n?????.????? 4,5\n??????????#??#??? 4,1,1,1,4\n??#?.???#??.?????#?# 2,1,4,1,1,1\n###.??.?#???#?? 3,1,6,1\n???##???.?##???##?? 5,8\n..???##???#?.# 6,2,1\n??..???????#???? 1,1,3,1,1\n..????#.???. 1,1,3\n???..??#??#???#??? 2,4,2\n??#??#???????##? 1,1,5,2\n.#??#?###..?????#.. 8,2,1,1\n.?????????? 1,4\n??##???????.##?.?? 5,2\n?###?.????#??##??#?? 5,11,1\n.?##??????? 3,1,2\n.?##???.?#?#?## 4,7\n?????##??? 2,4,1\n????##????#??????? 10,1,1\n????#???#.?..???? 1,1\n#??#????.?.????? 4,1,1,2\n?#?.?.??#?? 1,1,2\n?????.?#?. 4,1\n?.???????.????? 1,1,1,1,2\n?.???..?????#??#.? 3,8\n????#?.??? 3,1\n???#?#??#???##??? 1,12,1\n?#?..#???.?????????? 2,4,8\n?#???#?????#????? 3,1,5,3\n?..?.#???.?##?? 1,1,2\n?.??.??#?#?#?? 1,7\n.?##?#??.?# 5,1\n#??#?##??#?#?. 1,4,2,1\n.????####. 2,5\n????#???????? 7,3\n?#?.?#.????.? 1,2,1,1\n????????????#??? 1,10,1\n.??.???#???????..?? 1,6,1,1,2\n??.??.?????? 1,3,1\n?##?????#???.? 3,2,1,1\n?.??#??.?.????.??.?? 1,4,1,1,1,2\n??##????????#????? 1,2,2,8\n???#??##..?.?? 8,1,1\n??????..?#? 3,1\n??.??????#?#?.?.? 1,6\n?#????#???#?#?.?? 13,2\n#?????#???##??? 8,2\n???.??##.?.. 1,4,1\n?.?????.##???###?#?? 1,10\n?#?.#.?#??????. 1,1,8\n?.???#???.?.#?#?#.? 6,5\n#?" <> ...
```

## Part 1

```elixir
defmodule Part1 do
  def parse(text) do
    text
    |> String.split("\n", trim: true)
    |> Enum.map(&parse_line/1)
  end

  defp parse_line(text) do
    [pattern, groups] = String.split(text, " ", trim: true)
    pattern = String.graphemes(pattern)
    groups = String.split(groups, ",", trim: true) |> Enum.map(&String.to_integer/1)

    {pattern, groups}
  end

  def make_options([]), do: [[]]

  def make_options(pattern) do
    [head | tail] = pattern

    if head == "?" do
      make_options(tail)
      |> Enum.flat_map(
        &[
          ["." | &1],
          ["#" | &1]
        ]
      )
    else
      make_options(tail)
      |> Enum.map(&[head | &1])
    end
  end

  def count_groups(pattern, groups \\ [], current_group \\ 0)
  def count_groups([], groups, 0), do: groups
  def count_groups([], groups, current_group), do: groups ++ [current_group]

  def count_groups(pattern, groups, current_group) do
    [head | tail] = pattern

    case {head, current_group} do
      {".", 0} -> count_groups(tail, groups, 0)
      {".", n} -> count_groups(tail, groups ++ [n], 0)
      {"#", n} -> count_groups(tail, groups, n + 1)
    end
  end
end

Part1.parse(input)
|> Enum.flat_map(fn {pattern, groups} ->
  Part1.make_options(pattern)
  |> Enum.map(&{&1, groups})
end)
|> Enum.map(fn {pattern, groups} ->
  %{
    pattern: pattern,
    expected_groups: groups,
    found_groups: Part1.count_groups(pattern)
  }
end)
|> Enum.count(fn option ->
  option[:found_groups] == option[:expected_groups]
end)
```

<!-- livebook:{"output":true} -->

```
7090
```

## Part 2

```elixir
# Thanks, ChatGPT!
defmodule Combinations do
  use Memoize

  defmemo(choose(m, n) when m >= 0 and n >= 0 and m >= n,
    do: trunc(fact(m) / (fact(n) * fact(m - n)))
  )

  defp fact(0), do: 1
  defp fact(n), do: n * fact(n - 1)
end

defmodule Part2 do
  use Memoize

  def parse(text) do
    text
    |> String.split("\n", trim: true)
    |> Enum.map(&parse_line/1)
  end

  defp parse_line(text) do
    [pattern, groups] = String.split(text, " ", trim: true)
    pattern = String.graphemes(pattern)
    groups = String.split(groups, ",", trim: true) |> Enum.map(&String.to_integer/1)

    {
      pattern ++ ["?"] ++ pattern ++ ["?"] ++ pattern ++ ["?"] ++ pattern ++ ["?"] ++ pattern,
      groups ++ groups ++ groups ++ groups ++ groups
    }
  end

  # we've met our goal already, better not be any hashes
  defmemo count_possibilities(pattern, []) do
    if Enum.any?(pattern, &(&1 == "#")) do
      0
    else
      1
    end
  end

  # we ran out of pattern without meeting our goal, no ways left
  defmemo(count_possibilities([], _goal), do: 0)

  defmemo count_possibilities(pattern, goal) do
    [first_goal | remaining_goal] = goal

    needed =
      if length(remaining_goal) == 0 do
        first_goal
      else
        first_goal + 1
      end

    if length(pattern) < Enum.sum(goal) + length(goal) - 1 do
      0
    else
      # special case where only question marks remain
      if Enum.all?(pattern, &(&1 == "?")) do
        needed = Enum.sum(goal) + (length(goal) - 1)
        n = length(pattern) - needed
        m = length(goal) + n

        if n < 0 do
          0
        else
          Combinations.choose(m, n)
        end
      else
        [head | tail] = pattern

        case head do
          "?" ->
            # Let's try making this a dot
            # And try making it a #
            count_possibilities(tail, goal) +
              if !(pattern |> Enum.take(first_goal) |> Enum.any?(&(&1 == "."))) and
                   (remaining_goal == [] or Enum.at(pattern, first_goal) != "#") do
                count_possibilities(Enum.drop(pattern, needed), remaining_goal)
              else
                0
              end

          "#" ->
            if !(pattern |> Enum.take(first_goal) |> Enum.any?(&(&1 == "."))) and
                 (remaining_goal == [] or Enum.at(pattern, first_goal) != "#") do
              count_possibilities(Enum.drop(pattern, needed), remaining_goal)
            else
              0
            end

          "." ->
            count_possibilities(tail, goal)
        end
      end
    end
  end
end

Part2.parse(input)
|> Enum.map(fn {a, b} -> Part2.count_possibilities(a, b) end)
|> Enum.sum()
```

<!-- livebook:{"output":true} -->

```
6792010726877
```
